{% extends 'base_admin.html.twig' %}

{% block title %}Sale {{ sale.id }}{% endblock %}

{% block body %}
    <h1>Product</h1>
    {% if sale.isCancelled != 1 %}
        <a class="btn btn-danger text-white cancel_sale">Canelar Venta</a>
    {% endif %}

<div class="table-responsive">
    <table class="table table-bordered table-striped " id="dataTable" >
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ sale.id }}</td>
            </tr>
            <tr>
                <th>Cliente</th>
                <td>{{ sale.client }}</td>
            </tr>
            <tr>
                <th>Total</th>
                <td>{{ sale.total }}</td>
            </tr>

            <tr>
                <th>Fecha</th>
                <td>{{ sale.time ? sale.time|date('d-m-Y H:i:s') : '' }}</td>
            </tr>

            <tr>
                <th>Vendedor</th>
                <td>{{ sale.user.firstname ~ " " ~ sale.user.lastname }}</td>
            </tr>

            {% for product in sale.products %}
            <tr>
                <th>Product</th>
                <td>{{ product.product.name }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
    <a href="{{ path('sales_list') }}">back to list</a>




{% endblock %}

{% block pagejs %}

    <script src="{{ asset('theme/assets/extra-libs/datatables.net/js/jquery.dataTables.min.js') }}"></script>

    <script type="text/javascript">

        $('#zero_config').DataTable({
            "order": [
                [0, "desc"]
            ]
        });

          $(document).on('click', '.cancel_sale', function(){

              if (confirm("Deseas cancelar esta venta? El inventario se ajustara. Presiona OK para continuar")) {

                $.ajax({
                    url:"{{ path('sale_cancel') }}",
                    type: "POST",
                    data:{
                        saleID:{{ sale.id }}
                    },
                    success:function (php_result) {
                        console.log(php_result);
                        location.reload();

                    }

                });

                }
              

            });

        
    
    </script>
{% endblock %}